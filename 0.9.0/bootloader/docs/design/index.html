<!-- Elements added to "main.html" will be displayed on all pages -->


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.owntech.org/0.9.0/bootloader/docs/design/">
      
      
      
      
      <link rel="icon" href="../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Design - OwnTech Documentation Center</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-WF7P4ZR5NF"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-WF7P4ZR5NF",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-WF7P4ZR5NF",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
    <!-- main.html | Added "navigation.instant" support -->
    <link rel="canonical" href=".">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="grey">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bootloader" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OwnTech Documentation Center" class="md-header__button md-logo" aria-label="OwnTech Documentation Center" data-md-component="logo">
      
  <img src="../../../images/OwnTech.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OwnTech Documentation Center
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Design
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="grey"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../core/docs/environment_setup/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples/docs/home/" class="md-tabs__link">
          
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../core/docs/powerAPI/" class="md-tabs__link">
          
  
  Power API

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../controlLibrary/docs/getting-started/" class="md-tabs__link">
          
  
  Control Library

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Matlab/docs/getting_started/" class="md-tabs__link">
          
  
  MATLAB

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../OwnModels/docs/getting_started/" class="md-tabs__link">
          
  
  OwnModels

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../OwnPlot/docs/" class="md-tabs__link">
          
  
  OwnPlot

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OwnTech Documentation Center" class="md-nav__button md-logo" aria-label="OwnTech Documentation Center" data-md-component="logo">
      
  <img src="../../../images/OwnTech.png" alt="logo">

    </a>
    OwnTech Documentation Center
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Home
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/environment_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Environment Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/first_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    First Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/ownplot_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OwnPlot Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    MATLAB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            MATLAB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Matlab/docs/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Matlab/docs/first_compilation_with_matlab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    First compilation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Matlab/docs/open_loop_buck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open loop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Matlab/docs/closed_loop_buck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Closed loop
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/docs/home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SPIN
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            SPIN
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_1" id="__nav_3_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ADC
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            ADC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SPIN/ADC/adc_software_trigger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software triggered measurement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SPIN/ADC/adc_hrtim_trigger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synchronous measurements
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DAC
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            DAC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SPIN/DAC/signal_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Signal generation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_3" >
        
          
          <label class="md-nav__link" for="__nav_3_2_3" id="__nav_3_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LED
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_3">
            <span class="md-nav__icon md-icon"></span>
            LED
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SPIN/LED/blinky/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blinky
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_4" >
        
          
          <label class="md-nav__link" for="__nav_3_2_4" id="__nav_3_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PWM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_4">
            <span class="md-nav__icon md-icon"></span>
            PWM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SPIN/PWM/duty_cycle_setting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Duty cycle control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SPIN/PWM/phase_shift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phase shift control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SPIN/PWM/multiple_pwm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple PWM operation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_5" >
        
          
          <label class="md-nav__link" for="__nav_3_2_5" id="__nav_3_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Timer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_5">
            <span class="md-nav__icon md-icon"></span>
            Timer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SPIN/TIMER/incremental_encoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Incremental encoder
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    TWIST
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            TWIST
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_1" id="__nav_3_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DC DC topology examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            DC DC topology examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/DC_DC/buck_voltage_mode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Buck voltage mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/DC_DC/buck_current_mode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Buck current mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/DC_DC/boost_voltage_mode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Boost voltage mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/DC_DC/interleaved/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interleaved Buck
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2" id="__nav_3_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Microgrid examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            Microgrid examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/Microgrid/AC_client_server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AC client server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/Microgrid/AC_peer_to_peer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AC peer to peer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/Microgrid/DC_client_server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DC client server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/Microgrid/DC_droop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DC droop
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_3" id="__nav_3_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DC AC topology examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_3">
            <span class="md-nav__icon md-icon"></span>
            DC AC topology examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/DC_AC/grid_forming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grid forming Inverter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/TWIST/DC_AC/grid_following/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grid following Inverter
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Power API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Power API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/powerAPI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bootloader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SPIN API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            SPIN API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classSpinAPI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/adc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classCompHAL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    COMP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/dac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DAC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/gpio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPIO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classLedHAL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LED
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/pwm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PWM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classTimerHAL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TIMER
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classUartHAL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UART
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classVersionHAL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VERSION
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/twistAPI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TWIST API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/dataAPI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/docs/scheduling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Communication API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Communication API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classCommunicationAPI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classAnalogCommunication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analog Communication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classRs485Communication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RS485
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classCanCommunication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classSyncCommunication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Real Time Sync
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../powerAPI/classsafety/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Safety API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Control Library
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Control Library
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/docs/getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Controller
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Controller
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_1" >
        
          
          <label class="md-nav__link" for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Generic Controller
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_1">
            <span class="md-nav__icon md-icon"></span>
            Generic Controller
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/docs/controller/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Principle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/classController/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PID
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_2">
            <span class="md-nav__icon md-icon"></span>
            PID
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/docs/use-pid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/classPid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/structPidParams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parameters API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_3" >
        
          
          <label class="md-nav__link" for="__nav_5_2_3" id="__nav_5_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Proportional Resonant (PR)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_3">
            <span class="md-nav__icon md-icon"></span>
            Proportional Resonant (PR)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/docs/use-pr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/classPr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/structPrParams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parameters API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_4" >
        
          
          <label class="md-nav__link" for="__nav_5_2_4" id="__nav_5_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    RST
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_4">
            <span class="md-nav__icon md-icon"></span>
            RST
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/docs/use-rst/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/classRST/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/structRstParams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parameters API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Filters
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Filters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/docs/use-filters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3_2" >
        
          
          <label class="md-nav__link" for="__nav_5_3_2" id="__nav_5_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1st order Low Pass Filter
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_2">
            <span class="md-nav__icon md-icon"></span>
            1st order Low Pass Filter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/docs/use-firstorder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/classLowPassFirstOrderFilter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3_3" id="__nav_5_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notch Filter
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_3">
            <span class="md-nav__icon md-icon"></span>
            Notch Filter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/docs/use-notchfilter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/classNotchFilter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3_4" >
        
          
          <label class="md-nav__link" for="__nav_5_3_4" id="__nav_5_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Phase Lock Loop (PLL)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_4">
            <span class="md-nav__icon md-icon"></span>
            Phase Lock Loop (PLL)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/docs/use-pll/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/classPllSinus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controlLibrary/structPllDatas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PllDatas API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    MATLAB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            MATLAB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Matlab/docs/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Matlab/docs/first_compilation_with_matlab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    First compilation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Matlab/docs/open_loop_buck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open loop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Matlab/docs/closed_loop_buck/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Closed loop
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OwnModels
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            OwnModels
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnModels/docs/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started with PLECS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnModels/docs/first_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open loop example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnModels/docs/voltage_mode_simulation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Voltage mode example
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OwnPlot
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            OwnPlot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Manual
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            User Manual
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/user-manual/home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2_2" id="__nav_8_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/user-manual/setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/user-manual/dev-board-demo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dev board demo code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/user-manual/first-steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    My First Port
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2_3" >
        
          
          <label class="md-nav__link" for="__nav_8_2_3" id="__nav_8_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Components
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_3">
            <span class="md-nav__icon md-icon"></span>
            Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/user-manual/components/tabs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tabs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/user-manual/components/terminal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terminal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/user-manual/components/plotter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plotter
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/user-manual/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Manual
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Manual
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/dev-manual/home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Manual
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OwnPlot/docs/dev-manual/arch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-format" class="md-nav__link">
    <span class="md-ellipsis">
      Image format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flash-map" class="md-nav__link">
    <span class="md-ellipsis">
      Flash map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-slots" class="md-nav__link">
    <span class="md-ellipsis">
      Image slots
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Image slots">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#swap-using-scratch" class="md-nav__link">
    <span class="md-ellipsis">
      Swap using scratch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#swap-without-using-scratch" class="md-nav__link">
    <span class="md-ellipsis">
      Swap without using scratch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#equal-slots-direct-xip" class="md-nav__link">
    <span class="md-ellipsis">
      Equal slots (direct-xip)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ram-loading" class="md-nav__link">
    <span class="md-ellipsis">
      RAM loading
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boot-swap-types" class="md-nav__link">
    <span class="md-ellipsis">
      Boot swap types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Boot swap types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revert-mechanism-in-direct-xip-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Revert mechanism in direct-xip mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-trailer" class="md-nav__link">
    <span class="md-ellipsis">
      Image trailer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-trailers" class="md-nav__link">
    <span class="md-ellipsis">
      Image trailers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Image trailers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-swaps-non-resumes" class="md-nav__link">
    <span class="md-ellipsis">
      New swaps (non-resumes)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resumed-swaps" class="md-nav__link">
    <span class="md-ellipsis">
      Resumed swaps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high-level-operation" class="md-nav__link">
    <span class="md-ellipsis">
      High-level operation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="High-level operation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multiple-image-boot" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple image boot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-image-boot-for-ram-loading-and-direct-xip" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple image boot for RAM loading and direct-xip
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-swapping" class="md-nav__link">
    <span class="md-ellipsis">
      Image swapping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#swap-status" class="md-nav__link">
    <span class="md-ellipsis">
      Swap status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reset-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      Reset recovery
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrity-check" class="md-nav__link">
    <span class="md-ellipsis">
      Integrity check
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-hardware-keys-for-verification" class="md-nav__link">
    <span class="md-ellipsis">
      Using hardware keys for verification
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protected-tlvs" class="md-nav__link">
    <span class="md-ellipsis">
      Protected TLVs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-check" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency check
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#downgrade-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Downgrade prevention
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Downgrade prevention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#software-based-downgrade-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Software-based downgrade prevention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-based-downgrade-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware-based downgrade prevention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#measured-boot-and-data-sharing" class="md-nav__link">
    <span class="md-ellipsis">
      Measured boot and data sharing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-in-ci" class="md-nav__link">
    <span class="md-ellipsis">
      Testing in CI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing in CI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-fault-injection-hardening-fih" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Fault Injection Hardening (FIH)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<!--
  - SPDX-License-Identifier: Apache-2.0

  - Copyright (c) 2017-2020 Linaro LTD
  - Copyright (c) 2017-2019 JUUL Labs
  - Copyright (c) 2019-2023 Arm Limited

  - Original license:

  - Licensed to the Apache Software Foundation (ASF) under one
  - or more contributor license agreements.  See the NOTICE file
  - distributed with this work for additional information
  - regarding copyright ownership.  The ASF licenses this file
  - to you under the Apache License, Version 2.0 (the
  - "License"); you may not use this file except in compliance
  - with the License.  You may obtain a copy of the License at

  -  http://www.apache.org/licenses/LICENSE-2.0

  - Unless required by applicable law or agreed to in writing,
  - software distributed under the License is distributed on an
  - "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  - KIND, either express or implied.  See the License for the
  - specific language governing permissions and limitations
  - under the License.
-->

<h1 id="bootloader">Bootloader</h1>
<h2 id="summary"><a href="#summary">Summary</a></h2>
<p>MCUboot comprises two packages:</p>
<ul>
<li>The bootutil library (boot/bootutil)</li>
<li>The boot application (each port has its own at boot/<port>)</li>
</ul>
<p>The bootutil library performs most of the functions of a bootloader.  In
particular, the piece that is missing is the final step of actually jumping to
the main image.  This last step is instead implemented by the boot application.
Bootloader functionality is separated in this manner to enable unit testing of
the bootloader.  A library can be unit tested, but an application can't.
Therefore, functionality is delegated to the bootutil library when possible.</p>
<h2 id="limitations"><a href="#limitations">Limitations</a></h2>
<p>The bootloader currently only supports images with the following
characteristics:
* Built to run from flash.
* Built to run from a fixed location (i.e., not position-independent).</p>
<h2 id="image-format"><a href="#image-format">Image format</a></h2>
<p>The following definitions describe the image format.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="cp">#define IMAGE_MAGIC                 0x96f3b83d</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="cp">#define IMAGE_HEADER_SIZE           32</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">image_version</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">iv_major</span><span class="p">;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">iv_minor</span><span class="p">;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">iv_revision</span><span class="p">;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">iv_build_num</span><span class="p">;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">};</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="cm">/** Image header.  All fields are in little endian byte order. */</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="k">struct</span><span class="w"> </span><span class="nc">image_header</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ih_magic</span><span class="p">;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ih_load_addr</span><span class="p">;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">ih_hdr_size</span><span class="p">;</span><span class="w">           </span><span class="cm">/* Size of image header (bytes). */</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">ih_protect_tlv_size</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Size of protected TLV area (bytes). */</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ih_img_size</span><span class="p">;</span><span class="w">           </span><span class="cm">/* Does not include header. */</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ih_flags</span><span class="p">;</span><span class="w">              </span><span class="cm">/* IMAGE_F_[...]. */</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">image_version</span><span class="w"> </span><span class="n">ih_ver</span><span class="p">;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">_pad1</span><span class="p">;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="p">};</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="cp">#define IMAGE_TLV_INFO_MAGIC        0x6907</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="cp">#define IMAGE_TLV_PROT_INFO_MAGIC   0x6908</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="cm">/** Image TLV header.  All fields in little endian. */</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="k">struct</span><span class="w"> </span><span class="nc">image_tlv_info</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">it_magic</span><span class="p">;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">it_tlv_tot</span><span class="p">;</span><span class="w">  </span><span class="cm">/* size of TLV area (including tlv_info header) */</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="p">};</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="cm">/** Image trailer TLV format. All fields in little endian. */</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="k">struct</span><span class="w"> </span><span class="nc">image_tlv</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w">  </span><span class="n">it_type</span><span class="p">;</span><span class="w">   </span><span class="cm">/* IMAGE_TLV_[...]. */</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w">  </span><span class="n">_pad</span><span class="p">;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">it_len</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Data length (not including TLV header). */</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="p">};</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="cm">/*</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="cm"> * Image header flags.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="cm"> */</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="cp">#define IMAGE_F_PIC                      0x00000001 </span><span class="cm">/* Not supported. */</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="cp">#define IMAGE_F_ENCRYPTED_AES128         0x00000004 </span><span class="cm">/* Encrypted using AES128. */</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="cp">#define IMAGE_F_ENCRYPTED_AES256         0x00000008 </span><span class="cm">/* Encrypted using AES256. */</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="cp">#define IMAGE_F_NON_BOOTABLE             0x00000010 </span><span class="cm">/* Split image app. */</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="cp">#define IMAGE_F_RAM_LOAD                 0x00000020</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="cm">/*</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="cm"> * Image trailer TLV types.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="cm"> */</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="cp">#define IMAGE_TLV_KEYHASH           0x01   </span><span class="cm">/* hash of the public key */</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="cp">#define IMAGE_TLV_SHA256            0x10   </span><span class="cm">/* SHA256 of image hdr and body */</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="cp">#define IMAGE_TLV_RSA2048_PSS       0x20   </span><span class="cm">/* RSA2048 of hash output */</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="cp">#define IMAGE_TLV_ECDSA224          0x21   </span><span class="cm">/* ECDSA of hash output - Not supported anymore */</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="cp">#define IMAGE_TLV_ECDSA_SIG         0x22   </span><span class="cm">/* ECDSA of hash output */</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="cp">#define IMAGE_TLV_RSA3072_PSS       0x23   </span><span class="cm">/* RSA3072 of hash output */</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="cp">#define IMAGE_TLV_ED25519           0x24   </span><span class="cm">/* ED25519 of hash output */</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="cp">#define IMAGE_TLV_ENC_RSA2048       0x30   </span><span class="cm">/* Key encrypted with RSA-OAEP-2048 */</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="cp">#define IMAGE_TLV_ENC_KW            0x31   </span><span class="cm">/* Key encrypted with AES-KW-128 or</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="cm">                                              256 */</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="cp">#define IMAGE_TLV_ENC_EC256         0x32   </span><span class="cm">/* Key encrypted with ECIES-P256 */</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="cp">#define IMAGE_TLV_ENC_X25519        0x33   </span><span class="cm">/* Key encrypted with ECIES-X25519 */</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="cp">#define IMAGE_TLV_DEPENDENCY        0x40   </span><span class="cm">/* Image depends on other image */</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="cp">#define IMAGE_TLV_SEC_CNT           0x50   </span><span class="cm">/* security counter */</span>
</code></pre></div>
<p>Optional type-length-value records (TLVs) containing image metadata are placed
after the end of the image.</p>
<p>The <code>ih_protect_tlv_size</code> field indicates the length of the protected TLV area.
If protected TLVs are present then a TLV info header with magic equal to
<code>IMAGE_TLV_PROT_INFO_MAGIC</code> must be present and the protected TLVs (plus the
info header itself) have to be included in the hash calculation. Otherwise the
hash is only calculated over the image header and the image itself. In this
case the value of the <code>ih_protect_tlv_size</code> field is 0.</p>
<p>The <code>ih_hdr_size</code> field indicates the length of the header, and therefore the
offset of the image itself.  This field provides for backwards compatibility in
case of changes to the format of the image header.</p>
<h2 id="flash-map"><a href="#flash-map">Flash map</a></h2>
<p>A device's flash is partitioned according to its <em>flash map</em>.  At a high
level, the flash map maps numeric IDs to <em>flash areas</em>.  A flash area is a
region of disk with the following properties:
1. An area can be fully erased without affecting any other areas.
2. A write to one area does not restrict writes to other areas.</p>
<p>The bootloader uses the following flash area IDs:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="cm">/* Independent from multiple image boot */</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="cp">#define FLASH_AREA_BOOTLOADER         0</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="cp">#define FLASH_AREA_IMAGE_SCRATCH      3</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="cm">/* If the bootloader is working with the first image */</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="cp">#define FLASH_AREA_IMAGE_PRIMARY      1</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="cp">#define FLASH_AREA_IMAGE_SECONDARY    2</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="cm">/* If the bootloader is working with the second image */</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="cp">#define FLASH_AREA_IMAGE_PRIMARY      5</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="cp">#define FLASH_AREA_IMAGE_SECONDARY    6</span>
</code></pre></div></p>
<p>The bootloader area contains the bootloader image itself. The other areas are
described in subsequent sections. The flash could contain multiple executable
images therefore the flash area IDs of primary and secondary areas are mapped
based on the number of the active image (on which the bootloader is currently
working).</p>
<h2 id="image-slots"><a href="#image-slots">Image slots</a></h2>
<p>A portion of the flash memory can be partitioned into multiple image areas, each
contains two image slots: a primary slot and a secondary slot.
Normally, the bootloader will only run an image from the primary slot, so
images must be built such that they can run from that fixed location in flash
(the exception to this is the <a href="#direct-xip">direct-xip</a> and the
<a href="#ram-load">ram-load</a> upgrade mode). If the bootloader needs to run the
image resident in the secondary slot, it must copy its contents into the primary
slot before doing so, either by swapping the two images or by overwriting the
contents of the primary slot. The bootloader supports either swap- or
overwrite-based image upgrades, but must be configured at build time to choose
one of these two strategies.</p>
<h3 id="swap-using-scratch"><a href="#image-swap-using-scratch">Swap using scratch</a></h3>
<p>When swap-using-scratch algorithm is used, in addition to the slots of
image areas, the bootloader requires a scratch area to allow for reliable
image swapping. The scratch area must have a size
that is enough to store at least the largest sector that is going to be swapped.
Many devices have small equally sized flash sectors, eg 4K, while others have
variable sized sectors where the largest sectors might be 128K or 256K, so the
scratch must be big enough to store that. The scratch is only ever used when
swapping firmware, which means only when doing an upgrade. Given that, the main
reason for using a larger size for the scratch is that flash wear will be more
evenly distributed, because a single sector would be written twice the number of
times than using two sectors, for example. To evaluate the ideal size of the
scratch for your use case the following parameters are relevant:</p>
<ul>
<li>the ratio of image size / scratch size</li>
<li>the number of erase cycles supported by the flash hardware</li>
</ul>
<p>The image size is used (instead of slot size) because only the slot's sectors
that are actually used for storing the image are copied. The image/scratch ratio
is the number of times the scratch will be erased on every upgrade. The number
of erase cycles divided by the image/scratch ratio will give you the number of
times an upgrade can be performed before the device goes out of spec.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>num_upgrades = number_of_erase_cycles / (image_size / scratch_size)
</code></pre></div>
<p>Let's assume, for example, a device with 10000 erase cycles, an image size of
150K and a scratch of 4K (usual minimum size of 4K sector devices). This would
result in a total of:</p>
<p><code>10000 / (150 / 4) ~ 267</code></p>
<p>Increasing the scratch to 16K would give us:</p>
<p><code>10000 / (150 / 16) ~ 1067</code></p>
<p>There is no <em>best</em> ratio, as the right size is use-case dependent. Factors to
consider include the number of times a device will be upgraded both in the field
and during development, as well as any desired safety margin on the
manufacturer's specified number of erase cycles. In general, using a ratio that
allows hundreds to thousands of field upgrades in production is recommended.</p>
<p>swap-using scratch algorithm assumes that the primary and the secondary image
slot areas sizes are equal.
The maximum image size available for the application
will be:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>maximum-image-size = image-slot-size - image-trailer-size
</code></pre></div></p>
<p>Where:
  <code>image-slot-size</code> is the size of the image slot.
  <code>image-trailer-size</code> is the size of the image trailer.</p>
<h3 id="swap-without-using-scratch"><a href="#image-swap-no-scratch">Swap without using scratch</a></h3>
<p>This algorithm is an alternative to the swap-using-scratch algorithm.
It uses an additional sector in the primary slot to make swap possible.
The algorithm works as follows:</p>
<ol>
<li>Moves all sectors of the primary slot up by one sector.
    Beginning from N=0:</li>
<li>Copies the N-th sector from the secondary slot to the N-th sector of the
  primary slot.</li>
<li>Copies the (N+1)-th sector from the primary slot to the N-th sector of the
  secondary slot.</li>
<li>Repeats steps 2. and 3. until all the slots' sectors are swapped.</li>
</ol>
<p>This algorithm is designed so that the higher sector of the primary slot is
used only for allowing sectors to move up. Therefore the most
memory-size-effective slot layout is when the primary slot is exactly one sector
larger than the secondary slot, although same-sized slots are allowed as well.
The algorithm is limited to support sectors of the same
sector layout. All slot's sectors should be of the same size.</p>
<p>When using this algorithm the maximum image size available for the application
will be:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>maximum-image-size = (N-1) * slot-sector-size - image-trailer-sectors-size
</code></pre></div></p>
<p>Where:
  <code>N</code> is the number of sectors in the primary slot.
  <code>image-trailer-sectors-size</code> is the size of the image trailer rounded up to
  the total size of sectors its occupied. For instance if the image-trailer-size
  is equal to 1056 B and the sector size is equal to 1024 B, then
  <code>image-trailer-sectors-size</code> will be equal to 2048 B.</p>
<p>The algorithm does two erase cycles on the primary slot and one on the secondary
slot during each swap. Assuming that receiving a new image by the DFU
application requires 1 erase cycle on the secondary slot, this should result in
leveling the flash wear between the slots.</p>
<p>The algorithm is enabled using the <code>MCUBOOT_SWAP_USING_MOVE</code> option.</p>
<h3 id="equal-slots-direct-xip"><a href="#direct-xip">Equal slots (direct-xip)</a></h3>
<p>When the direct-xip mode is enabled the active image flag is "moved" between the
slots during image upgrade and in contrast to the above, the bootloader can
run an image directly from either the primary or the secondary slot (without
having to move/copy it into the primary slot). Therefore the image update
client, which downloads the new images must be aware, which slot contains the
active image and which acts as a staging area and it is responsible for loading
the proper images into the proper slot. All this requires that the images be
built to be executed from the corresponding slot. At boot time the bootloader
first looks for images in the slots and then inspects the version numbers in the
image headers. It selects the newest image (with the highest version number) and
then checks its validity (integrity check, signature verification etc.). If the
image is invalid MCUboot erases its memory slot and starts to validate the other
image. After a successful validation of the selected image the bootloader
chain-loads it.</p>
<p>An additional "revert" mechanism is also supported. For more information, please
read the <a href="#direct-xip-revert">corresponding section</a>.
Handling the primary and secondary slots as equals has its drawbacks. Since the
images are not moved between the slots, the on-the-fly image
encryption/decryption can't be supported (it only applies to storing the image
in an external flash on the device, the transport of encrypted image data is
still feasible).</p>
<p>The overwrite and the direct-xip upgrade strategies are substantially simpler to
implement than the image swapping strategy, especially since the bootloader must
work properly even when it is reset during the middle of an image swap. For this
reason, the rest of the document describes its behavior when configured to swap
images during an upgrade.</p>
<h3 id="ram-loading"><a href="#ram-load">RAM loading</a></h3>
<p>In ram-load mode the slots are equal. Like the direct-xip mode, this mode
also selects the newest image by reading the image version numbers in the image
headers. But instead of executing it in place, the newest image is copied to the
RAM for execution. The load address, the location in RAM where the image is
copied to, is stored in the image header. The ram-load upgrade mode can be
useful when there is no internal flash in the SoC, but there is a big enough
internal RAM to hold the images. Usually in this case the images are stored
in an external storage device. Execution from external storage has some
drawbacks (lower execution speed, image is exposed to attacks) therefore the
image is always copied to the internal RAM before the authentication and
execution. Ram-load mode requires the image to be built to be executed from
the RAM address range instead of the storage device address range. If
ram-load is enabled then platform must define the following parameters:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="cp">#define IMAGE_EXECUTABLE_RAM_START    &lt;area_base_addr&gt;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="cp">#define IMAGE_EXECUTABLE_RAM_SIZE     &lt;area_size_in_bytes&gt;</span>
</code></pre></div>
<p>For multiple image load if multiple ram regions are used platform must define
the <code>MULTIPLE_EXECUTABLE_RAM_REGIONS</code> flag instead and implement the following
function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">boot_get_image_exec_ram_info</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">image_id</span><span class="p">,</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">                                 </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">exec_ram_start</span><span class="p">,</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">                                 </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">exec_ram_size</span><span class="p">)</span>
</code></pre></div>
<p>When ram-load is enabled, the <code>--load-addr &lt;addr&gt;</code> option of the <code>imgtool</code>
script must also be used when signing the images. This option set the <code>RAM_LOAD</code>
flag in the image header which indicates that the image should be loaded to the
RAM and also set the load address in the image header.</p>
<p>When the encryption option is enabled (<code>MCUBOOT_ENC_IMAGES</code>) along with ram-load
the image is checked for encryption. If the image is not encrypted, RAM loading
happens as described above. If the image is encrypted, it is copied in RAM at
the provided address and then decrypted. Finally, the decrypted image is
authenticated in RAM and executed.</p>
<h2 id="boot-swap-types"><a href="#boot-swap-types">Boot swap types</a></h2>
<p>When the device first boots under normal circumstances, there is an up-to-date
firmware image in each primary slot, which MCUboot can validate and then
chain-load. In this case, no image swaps are necessary. During device upgrades,
however, new candidate image(s) is present in the secondary slot(s), which
MCUboot must swap into the primary slot(s) before booting as discussed above.</p>
<p>Upgrading an old image with a new one by swapping can be a two-step process. In
this process, MCUboot performs a "test" swap of image data in flash and boots
the new image or it will be executed during operation. The new image can then
update the contents of flash at runtime to mark itself "OK", and MCUboot will
then still choose to run it during the next boot. When this happens, the swap is
made "permanent". If this doesn't happen, MCUboot will perform a "revert" swap
during the next boot by swapping the image(s) back into its original location(s)
, and attempting to boot the old image(s).</p>
<p>Depending on the use case, the first swap can also be made permanent directly.
In this case, MCUboot will never attempt to revert the images on the next reset.</p>
<p>Test swaps are supported to provide a rollback mechanism to prevent devices
from becoming "bricked" by bad firmware.  If the device crashes immediately
upon booting a new (bad) image, MCUboot will revert to the old (working) image
at the next device reset, rather than booting the bad image again. This allows
device firmware to make test swaps permanent only after performing a self-test
routine.</p>
<p>On startup, MCUboot inspects the contents of flash to decide for each images
which of these "swap types" to perform; this decision determines how it
proceeds.</p>
<p>The possible swap types, and their meanings, are:</p>
<ul>
<li>
<p><code>BOOT_SWAP_TYPE_NONE</code>: The "usual" or "no upgrade" case; attempt to boot the
  contents of the primary slot.</p>
</li>
<li>
<p><code>BOOT_SWAP_TYPE_TEST</code>: Boot the contents of the secondary slot by swapping
  images.  Unless the swap is made permanent, revert back on the next boot.</p>
</li>
<li>
<p><code>BOOT_SWAP_TYPE_PERM</code>: Permanently swap images, and boot the upgraded image
  firmware.</p>
</li>
<li>
<p><code>BOOT_SWAP_TYPE_REVERT</code>: A previous test swap was not made permanent;
  swap back to the old image whose data are now in the secondary slot.  If the
  old image marks itself "OK" when it boots, the next boot will have swap type
  <code>BOOT_SWAP_TYPE_NONE</code>.</p>
</li>
<li>
<p><code>BOOT_SWAP_TYPE_FAIL</code>: Swap failed because image to be run is not valid.</p>
</li>
<li>
<p><code>BOOT_SWAP_TYPE_PANIC</code>: Swapping encountered an unrecoverable error.</p>
</li>
</ul>
<p>The "swap type" is a high-level representation of the outcome of the
boot. Subsequent sections describe how MCUboot determines the swap type from
the bit-level contents of flash.</p>
<h3 id="revert-mechanism-in-direct-xip-mode"><a href="#direct-xip-revert">Revert mechanism in direct-xip mode</a></h3>
<p>The direct-xip mode also supports a "revert" mechanism which is the equivalent
of the swap mode's "revert" swap. When the direct-xip mode is selected it can be
enabled with the MCUBOOT_DIRECT_XIP_REVERT config option and an image trailer
must also be added to the signed images (the "--pad" option of the <code>imgtool</code>
script must be used). For more information on this please read the
<a href="#image-trailer">Image Trailer</a> section and the <a href="../imgtool/">imgtool</a>
documentation. Making the images permanent (marking them as confirmed in
advance) is also supported just like in swap mode. The individual steps of the
direct-xip mode's "revert" mechanism are the following:</p>
<ol>
<li>Select the slot which holds the newest potential image.</li>
<li>Was the image previously selected to run (during a previous boot)?<ul>
<li>Yes: Did the image mark itself "OK" (was the self-test successful)?<ul>
<li>Yes.<ul>
<li>Proceed to step 3.</li>
</ul>
</li>
<li>No.<ul>
<li>Erase the image from the slot to prevent it from being selected
  again during the next boot.</li>
<li>Return to step 1 (the bootloader will attempt to select and
  possibly boot the previous image if there is one).</li>
</ul>
</li>
</ul>
</li>
<li>No.<ul>
<li>Mark the image as "selected" (set the copy_done flag in the trailer).</li>
<li>Proceed to step 3.</li>
</ul>
</li>
</ul>
</li>
<li>Proceed to image validation ...</li>
</ol>
<h2 id="image-trailer"><a href="#image-trailer">Image trailer</a></h2>
<p>For the bootloader to be able to determine the current state and what actions
should be taken during the current boot operation, it uses metadata stored in
the image flash areas. While swapping, some of this metadata is temporarily
copied into and out of the scratch area.</p>
<p>This metadata is located at the end of the image flash areas, and is called an
image trailer. An image trailer has the following structure:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>     0                   1                   2                   3
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    ~                                                               ~
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    ~    Swap status (BOOT_MAX_IMG_SECTORS * min-write-size * 3)    ~
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    ~                                                               ~
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    |                 Encryption key 0 (16 octets) [*]              |
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    |                                                               |
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    |                    0xff padding as needed                     |
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    |  (BOOT_MAX_ALIGN minus 16 octets from Encryption key 0) [*]   |
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    |                 Encryption key 1 (16 octets) [*]              |
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>    |                                                               |
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>    |                    0xff padding as needed                     |
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>    |  (BOOT_MAX_ALIGN minus 16 octets from Encryption key 1) [*]   |
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    |                      Swap size (4 octets)                     |
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>    |                    0xff padding as needed                     |
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>    |        (BOOT_MAX_ALIGN minus 4 octets from Swap size)         |
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>    |   Swap info   |  0xff padding (BOOT_MAX_ALIGN minus 1 octet)  |
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>    |   Copy done   |  0xff padding (BOOT_MAX_ALIGN minus 1 octet)  |
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>    |   Image OK    |  0xff padding (BOOT_MAX_ALIGN minus 1 octet)  |
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>    |                    0xff padding as needed                     |
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>    |         (BOOT_MAX_ALIGN minus 16 octets from MAGIC)           |
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>    |                       MAGIC (16 octets)                       |
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>    |                                                               |
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre></div>
<p>[*]: Only present if the encryption option is enabled (<code>MCUBOOT_ENC_IMAGES</code>).</p>
<p>The offset immediately following such a record represents the start of the next
flash area.</p>
<hr />
<p><strong><em>Note</em></strong></p>
<p><em>"min-write-size" is a property of the flash hardware.  If the hardware</em>
<em>allows individual bytes to be written at arbitrary addresses, then</em>
<em>min-write-size is 1.  If the hardware only allows writes at even addresses,</em>
<em>then min-write-size is 2, and so on.</em></p>
<hr />
<p>An image trailer contains the following fields:</p>
<ol>
<li>
<p>Swap status: A series of records which records the progress of an image
   swap.  To swap entire images, data are swapped between the two image areas
   one or more sectors at a time, like this:</p>
</li>
<li>
<p>sector data in the primary slot is copied into scratch, then erased</p>
</li>
<li>sector data in the secondary slot is copied into the primary slot,
     then erased</li>
<li>sector data in scratch is copied into the secondary slot</li>
</ol>
<p>As it swaps images, the bootloader updates the swap status field in a way that
allows it to compute how far this swap operation has progressed for each
sector.  The swap status field can thus used to resume a swap operation if the
bootloader is halted while a swap operation is ongoing and later reset. The
<code>BOOT_MAX_IMG_SECTORS</code> value is the configurable maximum number of sectors
MCUboot supports for each image; its value defaults to 128, but allows for
either decreasing this size, to limit RAM usage, or to increase it in devices
that have massive amounts of Flash or very small sized sectors and thus require
a bigger configuration to allow for the handling of all slot's sectors.
The factor of min-write-size is due to the behavior of flash hardware. The factor
of 3 is explained below.</p>
<ol>
<li>
<p>Encryption keys: key-encrypting keys (KEKs).  These keys are needed for
   image encryption and decryption.  See the
   <a href="../encrypted_images/">encrypted images</a> document for more information.</p>
</li>
<li>
<p>Swap size: When beginning a new swap operation, the total size that needs
   to be swapped (based on the slot with largest image + TLVs) is written to
   this location for easier recovery in case of a reset while performing the
   swap.</p>
</li>
<li>
<p>Swap info: A single byte which encodes the following information:</p>
<ul>
<li>Swap type: Stored in bits 0-3. Indicating the type of swap operation in
progress. When MCUboot resumes an interrupted swap, it uses this field to
determine the type of operation to perform. This field contains one of the
following values in the table below.</li>
<li>Image number: Stored in bits 4-7. It has always 0 value at single image
boot. In case of multi image boot it indicates, which image was swapped when
interrupt happened. The same scratch area is used during in case of all
image swap operation. Therefore this field is used to determine which image
the trailer belongs to if boot status is found on scratch area when the swap
operation is resumed.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BOOT_SWAP_TYPE_TEST</code></td>
<td>2</td>
</tr>
<tr>
<td><code>BOOT_SWAP_TYPE_PERM</code></td>
<td>3</td>
</tr>
<tr>
<td><code>BOOT_SWAP_TYPE_REVERT</code></td>
<td>4</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>Copy done: A single byte indicating whether the image in this slot is
   complete (0x01=done; 0xff=not done).</p>
</li>
<li>
<p>Image OK: A single byte indicating whether the image in this slot has been
   confirmed as good by the user (0x01=confirmed; 0xff=not confirmed).</p>
</li>
<li>
<p>MAGIC: A 16-byte field identifying the image trailer layout. It may assume
   distinct values depending on the maximum supported write alignment
   (<code>BOOT_MAX_ALIGN</code>) of the image, as defined by the following construct:</p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">union</span><span class="w"> </span><span class="nc">boot_img_magic_t</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="p">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">        </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">align</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">        </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">magic</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">val</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="p">};</span>
</code></pre></div>
  If <code>BOOT_MAX_ALIGN</code> is <strong>8 bytes</strong>, then MAGIC contains the following 16 bytes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">const</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="nc">boot_img_magic_t</span><span class="w"> </span><span class="n">boot_img_magic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="p">.</span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">        </span><span class="mh">0x77</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x95</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf3</span><span class="p">,</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">        </span><span class="mh">0x60</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xef</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7f</span><span class="p">,</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">        </span><span class="mh">0x35</span><span class="p">,</span><span class="w"> </span><span class="mh">0x52</span><span class="p">,</span><span class="w"> </span><span class="mh">0x50</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0f</span><span class="p">,</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">        </span><span class="mh">0x2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x79</span><span class="p">,</span><span class="w"> </span><span class="mh">0x80</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="p">};</span>
</code></pre></div>
<p>In case <code>BOOT_MAX_ALIGN</code> is defined to any value different than <strong>8</strong>, then the maximum
  supported write alignment value is encoded in the MAGIC field, followed by a fixed
  14-byte pattern:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">const</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="nc">boot_img_magic_t</span><span class="w"> </span><span class="n">boot_img_magic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="p">.</span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BOOT_MAX_ALIGN</span><span class="p">,</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="p">.</span><span class="n">magic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">        </span><span class="mh">0x2d</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe1</span><span class="p">,</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">        </span><span class="mh">0x5d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x29</span><span class="p">,</span><span class="w"> </span><span class="mh">0x41</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0b</span><span class="p">,</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">        </span><span class="mh">0x8d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x77</span><span class="p">,</span><span class="w"> </span><span class="mh">0x67</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9c</span><span class="p">,</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">        </span><span class="mh">0x11</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8a</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="p">};</span>
</code></pre></div>
<hr />
<p><strong><em>Note</em></strong>
Be aware that the image trailers make the ending area of the image slot
unavailable for carrying the image data. In particular, the swap status size
could be huge. For example, for 128 slot sectors with a 4-byte alignment,
it would become 1536 B.</p>
<hr />
<h2 id="image-trailers"><a href="#image-trailers">Image trailers</a></h2>
<p>At startup, the bootloader determines the boot swap type by inspecting the
image trailers.  When using the term "image trailers" what is meant is the
aggregate information provided by both image slot's trailers.</p>
<h3 id="new-swaps-non-resumes"><a href="#new-swaps-non-resumes">New swaps (non-resumes)</a></h3>
<p>For new swaps, MCUboot must inspect a collection of fields to determine which
swap operation to perform.</p>
<p>The image trailers records are structured around the limitations imposed by
flash hardware. As a consequence, they do not have a very intuitive design, and
it is difficult to get a sense of the state of the device just by looking at the
image trailers.  It is better to map all the possible trailer states to the swap
types described above via a set of tables.  These tables are reproduced below.</p>
<hr />
<p><strong><em>Note</em></strong></p>
<p><em>An important caveat about the tables described below is that they must</em>
<em>be evaluated in the order presented here. Lower state numbers must have a</em>
<em>higher priority when testing the image trailers.</em></p>
<hr />
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>    State I
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>                     | primary slot | secondary slot |
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    -----------------+--------------+----------------|
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>               magic | Any          | Good           |
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>            image-ok | Any          | Unset          |
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>           copy-done | Any          | Any            |
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    -----------------+--------------+----------------&#39;
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>     result: BOOT_SWAP_TYPE_TEST                     |
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>    -------------------------------------------------&#39;
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>    State II
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>                     | primary slot | secondary slot |
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>    -----------------+--------------+----------------|
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>               magic | Any          | Good           |
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>            image-ok | Any          | 0x01           |
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>           copy-done | Any          | Any            |
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>    -----------------+--------------+----------------&#39;
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>     result: BOOT_SWAP_TYPE_PERM                     |
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>    -------------------------------------------------&#39;
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>    State III
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>                     | primary slot | secondary slot |
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>    -----------------+--------------+----------------|
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>               magic | Good         | Unset          |
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>            image-ok | 0xff         | Any            |
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>           copy-done | 0x01         | Any            |
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>    -----------------+--------------+----------------&#39;
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>     result: BOOT_SWAP_TYPE_REVERT                   |
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>    -------------------------------------------------&#39;
</code></pre></div>
<p>Any of the above three states results in MCUboot attempting to swap images.</p>
<p>Otherwise, MCUboot does not attempt to swap images, resulting in one of the
other three swap types, as illustrated by State IV.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>    State IV
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>                     | primary slot | secondary slot |
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    -----------------+--------------+----------------|
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>               magic | Any          | Any            |
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>            image-ok | Any          | Any            |
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>           copy-done | Any          | Any            |
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    -----------------+--------------+----------------&#39;
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>     result: BOOT_SWAP_TYPE_NONE,                    |
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>             BOOT_SWAP_TYPE_FAIL, or                 |
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>             BOOT_SWAP_TYPE_PANIC                    |
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    -------------------------------------------------&#39;
</code></pre></div>
<p>In State IV, when no errors occur, MCUboot will attempt to boot the contents of
the primary slot directly, and the result is <code>BOOT_SWAP_TYPE_NONE</code>. If the image
in the primary slot is not valid, the result is <code>BOOT_SWAP_TYPE_FAIL</code>. If a
fatal error occurs during boot, the result is <code>BOOT_SWAP_TYPE_PANIC</code>. If the
result is either <code>BOOT_SWAP_TYPE_FAIL</code> or <code>BOOT_SWAP_TYPE_PANIC</code>, MCUboot hangs
rather than booting an invalid or compromised image.</p>
<hr />
<p><strong><em>Note</em></strong></p>
<p><em>An important caveat to the above is the result when a swap is requested</em>
<em>and the image in the secondary slot fails to validate, due to a hashing or</em>
<em>signing error. This state behaves as State IV with the extra action of</em>
<em>marking the image in the primary slot as "OK", to prevent further attempts</em>
<em>to swap.</em></p>
<hr />
<h3 id="resumed-swaps"><a href="#resumed-swaps">Resumed swaps</a></h3>
<p>If MCUboot determines that it is resuming an interrupted swap (i.e., a reset
occurred mid-swap), it fully determines the operation to resume by reading the
<code>swap info</code> field from the active trailer and extracting the swap type from bits
0-3. The set of tables in the previous section are not necessary in the resume
case.</p>
<h2 id="high-level-operation"><a href="#high-level-operation">High-level operation</a></h2>
<p>With the terms defined, we can now explore the bootloader's operation.  First,
a high-level overview of the boot process is presented.  Then, the following
sections describe each step of the process in more detail.</p>
<p>Procedure:</p>
<ol>
<li>
<p>Inspect swap status region; is an interrupted swap being resumed?</p>
<ul>
<li>Yes: Complete the partial swap operation; skip to step 3.</li>
<li>No: Proceed to step 2.</li>
</ul>
</li>
<li>
<p>Inspect image trailers; is a swap requested?</p>
<ul>
<li>
<p>Yes:</p>
<ol>
<li>Is the requested image valid (integrity and security check)?<ul>
<li>Yes.
    a. Perform swap operation.
    b. Persist completion of swap procedure to image trailers.
    c. Proceed to step 3.</li>
<li>No.
    a. Erase invalid image.
    b. Persist failure of swap procedure to image trailers.
    c. Proceed to step 3.</li>
</ul>
</li>
</ol>
</li>
<li>
<p>No: Proceed to step 3.</p>
</li>
</ul>
</li>
<li>
<p>Boot into image in primary slot.</p>
</li>
</ol>
<h3 id="multiple-image-boot"><a href="#multiple-image-boot">Multiple image boot</a></h3>
<p>When the flash contains multiple executable images the bootloader's operation
is a bit more complex but similar to the previously described procedure with
one image. Every image can be updated independently therefore the flash is
partitioned further to arrange two slots for each image.
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>+--------------------+
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>| MCUboot            |
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>+--------------------+
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        ~~~~~            &lt;- memory might be not contiguous
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>+--------------------+
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>| Image 0            |
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>| primary   slot     |
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>+--------------------+
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>| Image 0            |
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>| secondary slot     |
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>+--------------------+
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>        ~~~~~            &lt;- memory might be not contiguous
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>+--------------------+
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>| Image N            |
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>| primary   slot     |
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>+--------------------+
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>| Image N            |
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>| secondary slot     |
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>+--------------------+
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>| Scratch            |
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>+--------------------+
</code></pre></div>
MCUboot is also capable of handling dependencies between images. For example
if an image needs to be reverted it might be necessary to revert another one too
(e.g. due to API incompatibilities) or simply to prevent from being updated
because of an unsatisfied dependency. Therefore all aborted swaps have to be
completed and all the swap types have to be determined for each image before
the dependency checks. Dependency handling is described in more detail in a
following section. The multiple image boot procedure is organized in loops which
iterate over all the firmware images. The high-level overview of the boot
process is presented below.</p>
<ul>
<li>
<p>Loop 1. Iterate over all images</p>
<ol>
<li>
<p>Inspect swap status region of current image; is an interrupted swap being
   resumed?</p>
<ul>
<li>Yes:<ul>
<li>Review the validity of previously determined swap types
  of other images.</li>
<li>Complete the partial swap operation.</li>
<li>Mark the swap type as <code>None</code>.</li>
<li>Skip to next image.</li>
</ul>
</li>
<li>No: Proceed to step 2.</li>
</ul>
</li>
<li>
<p>Inspect image trailers in the primary and secondary slot; is an image
   swap requested?</p>
<ul>
<li>Yes: Review the validity of previously determined swap types of other
       images. Is the requested image valid (integrity and security
       check)?<ul>
<li>Yes:<ul>
<li>Set the previously determined swap type for the current image.</li>
<li>Skip to next image.</li>
</ul>
</li>
<li>No:<ul>
<li>Erase invalid image.</li>
<li>Persist failure of swap procedure to image trailers.</li>
<li>Mark the swap type as <code>Fail</code>.</li>
<li>Skip to next image.</li>
</ul>
</li>
</ul>
</li>
<li>No:<ul>
<li>Mark the swap type as <code>None</code>.</li>
<li>Skip to next image.</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Loop 2. Iterate over all images</p>
<ol>
<li>Does the current image depend on other image(s)?<ul>
<li>Yes: Are all the image dependencies satisfied?<ul>
<li>Yes: Skip to next image.</li>
<li>No:<ul>
<li>Modify swap type depending on what the previous type was.</li>
<li>Restart dependency check from the first image.</li>
</ul>
</li>
</ul>
</li>
<li>No: Skip to next image.</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Loop 3. Iterate over all images</p>
<ol>
<li>Is an image swap requested?<ul>
<li>Yes:<ul>
<li>Perform image update operation.</li>
<li>Persist completion of swap procedure to image trailers.</li>
<li>Skip to next image.</li>
</ul>
</li>
<li>No: Skip to next image.</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Loop 4. Iterate over all images</p>
<ol>
<li>Validate image in the primary slot (integrity and security check) or
   at least do a basic sanity check to avoid booting into an empty flash
   area.</li>
</ol>
</li>
<li>
<p>Boot into image in the primary slot of the 0th image position\
  (other image in the boot chain is started by another image).</p>
</li>
</ul>
<h3 id="multiple-image-boot-for-ram-loading-and-direct-xip"><a href="#multiple-image-boot-for-ram-loading-and-direct-xip">Multiple image boot for RAM loading and direct-xip</a></h3>
<p>The operation of the bootloader is different when the ram-load or the
direct-xip strategy is chosen. The flash map is very similar to the swap
strategy but there is no need for Scratch area.</p>
<ul>
<li>
<p>Loop 1. Until all images are loaded and all dependencies are satisfied</p>
<ol>
<li>
<p>Subloop 1. Iterate over all images</p>
<ul>
<li>Does any of the slots contain an image?<ul>
<li>Yes:<ul>
<li>Choose the newer image.</li>
<li>Copy it to RAM in case of ram-load strategy.</li>
<li>Validate the image (integrity and security check).</li>
<li>If validation fails delete the image from flash and try the other
  slot. (Image must be deleted from RAM too in case of ram-load
  strategy.)</li>
</ul>
</li>
<li>No: Return with failure.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Subloop 2. Iterate over all images</p>
<ul>
<li>Does the current image depend on other image(s)?<ul>
<li>Yes: Are all the image dependencies satisfied?<ul>
<li>Yes: Skip to next image.</li>
<li>No:<ul>
<li>Delete the image from RAM in case of ram-load strategy, but
  do not delete it from flash.</li>
<li>Try to load the image from the other slot.</li>
<li>Restart dependency check from the first image.</li>
</ul>
</li>
</ul>
</li>
<li>No: Skip to next image.</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Loop 2. Iterate over all images</p>
<ul>
<li>Increase the security counter if needed.</li>
<li>Do the measured boot and the data sharing if needed.</li>
</ul>
</li>
<li>
<p>Boot the loaded slot of image 0.</p>
</li>
</ul>
<h2 id="image-swapping"><a href="#image-swapping">Image swapping</a></h2>
<p>The bootloader swaps the contents of the two image slots for two reasons:</p>
<ul>
<li>User has issued a "set pending" operation; the image in the secondary slot
    should be run once (state I) or repeatedly (state II), depending on
    whether a permanent swap was specified.</li>
<li>Test image rebooted without being confirmed; the bootloader should
    revert to the original image currently in the secondary slot (state III).</li>
</ul>
<p>If the image trailers indicates that the image in the secondary slot should be
run, the bootloader needs to copy it to the primary slot.  The image currently
in the primary slot also needs to be retained in flash so that it can be used
later.  Furthermore, both images need to be recoverable if the bootloader
resets in the middle of the swap operation.  The two images are swapped
according to the following procedure:</p>
<ol>
<li>Determine if both slots are compatible enough to have their images swapped.
   To be compatible, both have to have only sectors that can fit into the
   scratch area and if one of them has larger sectors than the other, it must
   be able to entirely fit some rounded number of sectors from the other slot.
   In the next steps we'll use the terminology "region" for the total amount of
   data copied/erased because this can be any amount of sectors depending on
   how many the scratch is able to fit for some swap operation.</li>
<li>Iterate the list of region indices in descending order (i.e., starting
   with the greatest index); only regions that are predetermined to be part of
   the image are copied; current element = "index".<ul>
<li>a. Erase scratch area.</li>
<li>b. Copy secondary_slot[index] to scratch area.<ul>
<li>If this is the last region in the slot, scratch area has a temporary
  status area initialized to store the initial state, because the
  primary slot's last region will have to be erased. In this case,
  only the data that was calculated to amount to the image is copied.</li>
<li>Else if this is the first swapped region but not the last region in
  the slot, initialize the status area in primary slot and copy the
  full region contents.</li>
<li>Else, copy entire region contents.</li>
</ul>
</li>
<li>c. Write updated swap status (i).</li>
<li>d. Erase secondary_slot[index]</li>
<li>e. Copy primary_slot[index] to secondary_slot[index] according to amount
     previosly copied at step b.<ul>
<li>If this is not the last region in the slot, erase the trailer in the
  secondary slot, to always use the one in the primary slot.</li>
</ul>
</li>
<li>f. Write updated swap status (ii).</li>
<li>g. Erase primary_slot[index].</li>
<li>h. Copy scratch area to primary_slot[index] according to amount
     previously copied at step b.<ul>
<li>If this is the last region in the slot, the status is read from
  scratch (where it was stored temporarily) and written anew in the
  primary slot.</li>
</ul>
</li>
<li>i. Write updated swap status (iii).</li>
</ul>
</li>
<li>Persist completion of swap procedure to the primary slot image trailer.</li>
</ol>
<p>The additional caveats in step 2f are necessary so that the secondary slot image
trailer can be written by the user at a later time.  With the image trailer
unwritten, the user can test the image in the secondary slot
(i.e., transition to state I).</p>
<hr />
<p><strong><em>Note</em></strong></p>
<p><em>If the region being copied contains the last sector, then swap status is</em>
<em>temporarily maintained on scratch for the duration of this operation, always</em>
<em>using the primary slot's area otherwise.</em></p>
<hr />
<p><strong><em>Note</em></strong></p>
<p><em>The bootloader tries to copy only used sectors (based on largest image</em>
<em>installed on any of the slots), minimizing the amount of sectors copied and</em>
<em>reducing the amount of time required for a swap operation.</em></p>
<hr />
<p>The particulars of step 3 vary depending on whether an image is being tested,
permanently used, reverted or a validation failure of the secondary slot
happened when a swap was requested:</p>
<div class="highlight"><pre><span></span><code>* test:
    o Write primary_slot.copy_done = 1
    (swap caused the following values to be written:
        primary_slot.magic = BOOT_MAGIC
        secondary_slot.magic = UNSET
        primary_slot.image_ok = Unset)

* permanent:
    o Write primary_slot.copy_done = 1
    (swap caused the following values to be written:
        primary_slot.magic = BOOT_MAGIC
        secondary_slot.magic = UNSET
        primary_slot.image_ok = 0x01)

* revert:
    o Write primary_slot.copy_done = 1
    o Write primary_slot.image_ok = 1
    (swap caused the following values to be written:
        primary_slot.magic = BOOT_MAGIC)

* failure to validate the secondary slot:
    o Write primary_slot.image_ok = 1
</code></pre></div>
<p>After completing the operations as described above the image in the primary slot
should be booted.</p>
<h2 id="swap-status"><a href="#swap-status">Swap status</a></h2>
<p>The swap status region allows the bootloader to recover in case it restarts in
the middle of an image swap operation.  The swap status region consists of a
series of single-byte records.  These records are written independently, and
therefore must be padded according to the minimum write size imposed by the
flash hardware.  In the below figure, a min-write-size of 1 is assumed for
simplicity.  The structure of the swap status region is illustrated below.  In
this figure, a min-write-size of 1 is assumed for simplicity.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>     0                   1                   2                   3
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    |sec127,state 0 |sec127,state 1 |sec127,state 2 |sec126,state 0 |
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    |sec126,state 1 |sec126,state 2 |sec125,state 0 |sec125,state 1 |
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    |sec125,state 2 |                                               |
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>    +-+-+-+-+-+-+-+-+                                               +
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    ~                                                               ~
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>    ~               [Records for indices 124 through 1              ~
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>    ~                                                               ~
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>    ~               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>    ~               |sec000,state 0 |sec000,state 1 |sec000,state 2 |
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre></div>
<p>The above is probably not helpful at all; here is a description in English.</p>
<p>Each image slot is partitioned into a sequence of flash sectors.  If we were to
enumerate the sectors in a single slot, starting at 0, we would have a list of
sector indices.  Since there are two image slots, each sector index would
correspond to a pair of sectors.  For example, sector index 0 corresponds to
the first sector in the primary slot and the first sector in the secondary slot.
Finally, reverse the list of indices such that the list starts with index
<code>BOOT_MAX_IMG_SECTORS - 1</code> and ends with 0.  The swap status region is a
representation of this reversed list.</p>
<p>During a swap operation, each sector index transitions through four separate
states:
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>0. primary slot: image 0,   secondary slot: image 1,   scratch: N/A
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>1. primary slot: image 0,   secondary slot: N/A,       scratch: image 1 (1-&gt;s, erase 1)
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>2. primary slot: N/A,       secondary slot: image 0,   scratch: image 1 (0-&gt;1, erase 0)
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>3. primary slot: image 1,   secondary slot: image 0,   scratch: N/A     (s-&gt;0)
</code></pre></div></p>
<p>Each time a sector index transitions to a new state, the bootloader writes a
record to the swap status region.  Logically, the bootloader only needs one
record per sector index to keep track of the current swap state.  However, due
to limitations imposed by flash hardware, a record cannot be overwritten when
an index's state changes.  To solve this problem, the bootloader uses three
records per sector index rather than just one.</p>
<p>Each sector-state pair is represented as a set of three records.  The record
values map to the above four states as follows</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>            | rec0 | rec1 | rec2
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    --------+------+------+------
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    state 0 | 0xff | 0xff | 0xff
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    state 1 | 0x01 | 0xff | 0xff
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    state 2 | 0x01 | 0x02 | 0xff
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    state 3 | 0x01 | 0x02 | 0x03
</code></pre></div>
<p>The swap status region can accommodate <code>BOOT_MAX_IMG_SECTORS</code> sector indices.
Hence, the size of the region, in bytes, is
<code>BOOT_MAX_IMG_SECTORS * min-write-size * 3</code>. The only requirement for the index
count is that it is great enough to account for a maximum-sized image
(i.e., at least as great as the total sector count in an image slot).  If a
device's image slots have been configured with <code>BOOT_MAX_IMG_SECTORS: 128</code> and
use less than 128 sectors, the first record that gets written will be somewhere
in the middle of the region. For example, if a slot uses 64 sectors, the first
sector index that gets swapped is 63, which corresponds to the exact halfway
point within the region.</p>
<hr />
<p><strong><em>Note</em></strong></p>
<p><em>Since the scratch area only ever needs to record swapping of the last</em>
<em>sector, it uses at most min-write-size * 3 bytes for its own status area.</em></p>
<hr />
<h2 id="reset-recovery"><a href="#reset-recovery">Reset recovery</a></h2>
<p>If the bootloader resets in the middle of a swap operation, the two images may
be discontiguous in flash.  Bootutil recovers from this condition by using the
image trailers to determine how the image parts are distributed in flash.</p>
<p>The first step is determine where the relevant swap status region is located.
Because this region is embedded within the image slots, its location in flash
changes during a swap operation.  The below set of tables map image trailers
contents to swap status location.  In these tables, the "source" field
indicates where the swap status region is located. In case of multi image boot
the images primary area and the single scratch area is always examined in pairs.
If swap status found on scratch area then it might not belong to the current
image. The swap_info field of swap status stores the corresponding image number.
If it does not match then "source: none" is returned.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>              | primary slot | scratch      |
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    ----------+--------------+--------------|
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>        magic | Good         | Any          |
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    copy-done | 0x01         | N/A          |
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    ----------+--------------+--------------&#39;
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>    source: none                            |
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>    ----------------------------------------&#39;
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>              | primary slot | scratch      |
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>    ----------+--------------+--------------|
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>        magic | Good         | Any          |
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>    copy-done | 0xff         | N/A          |
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>    ----------+--------------+--------------&#39;
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>    source: primary slot                    |
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>    ----------------------------------------&#39;
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>              | primary slot | scratch      |
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>    ----------+--------------+--------------|
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>        magic | Any          | Good         |
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>    copy-done | Any          | N/A          |
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>    ----------+--------------+--------------&#39;
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>    source: scratch                         |
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>    ----------------------------------------&#39;
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>              | primary slot | scratch      |
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>    ----------+--------------+--------------|
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>        magic | Unset        | Any          |
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>    copy-done | 0xff         | N/A          |
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>    ----------+--------------+--------------|
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>    source: primary slot                    |
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>    ----------------------------------------+------------------------------+
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>    This represents one of two cases:                                      |
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>    o No swaps ever (no status to read, so no harm in checking).           |
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>    o Mid-revert; status in the primary slot.                              |
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>    For this reason we assume the primary slot as source, to trigger a     |
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>    check of the status area and find out if there was swapping under way. |
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>    -----------------------------------------------------------------------&#39;
</code></pre></div>
<p>If the swap status region indicates that the images are not contiguous, MCUboot
determines the type of swap operation that was interrupted by reading the <code>swap
info</code> field in the active image trailer and extracting the swap type from bits
0-3 then resumes the operation. In other words, it applies the procedure defined
in the previous section, moving image 1 into the primary slot and image 0 into
the secondary slot. If the boot status indicates that an image part is present
in the scratch area, this part is copied into the correct location by starting
at step e or step h in the area-swap procedure, depending on whether the part
belongs to image 0 or image 1.</p>
<p>After the swap operation has been completed, the bootloader proceeds as though
it had just been started.</p>
<h2 id="integrity-check"><a href="#integrity-check">Integrity check</a></h2>
<p>An image is checked for integrity immediately before it gets copied into the
primary slot.  If the bootloader doesn't perform an image swap, then it can
perform an optional integrity check of the image in the primary slot if
<code>MCUBOOT_VALIDATE_PRIMARY_SLOT</code> is set, otherwise it doesn't perform an
integrity check.</p>
<p>During the integrity check, the bootloader verifies the following aspects of
an image:</p>
<ul>
<li>32-bit magic number must be correct (<code>IMAGE_MAGIC</code>).</li>
<li>Image must contain an <code>image_tlv_info</code> struct, identified by its magic
    (<code>IMAGE_TLV_PROT_INFO_MAGIC</code> or <code>IMAGE_TLV_INFO_MAGIC</code>) exactly following
    the firmware (<code>hdr_size</code> + <code>img_size</code>). If <code>IMAGE_TLV_PROT_INFO_MAGIC</code> is
    found then after <code>ih_protect_tlv_size</code> bytes, another <code>image_tlv_info</code>
    with magic equal to <code>IMAGE_TLV_INFO_MAGIC</code> must be present.</li>
<li>Image must contain a SHA256 TLV.</li>
<li>Calculated SHA256 must match SHA256 TLV contents.</li>
<li>Image <em>may</em> contain a signature TLV.  If it does, it must also have a
    KEYHASH TLV with the hash of the key that was used to sign. The list of
    keys will then be iterated over looking for the matching key, which then
    will then be used to verify the image contents.</li>
</ul>
<p>For low performance MCU's where the validation is a heavy process at boot
(~1-2 seconds on a arm-cortex-M0), the <code>MCUBOOT_VALIDATE_PRIMARY_SLOT_ONCE</code>
could be used. This option will cache the validation result as described above
into the magic area of the primary slot. The next boot, the validation will be
skipped if the previous validation was succesfull. This option is reducing the
security level since if an attacker could modify the contents of the flash after
a good image has been validated, the attacker could run his own image without
running validation again. Enabling this option should be done with care.</p>
<h2 id="security"><a href="#security">Security</a></h2>
<p>As indicated above, the final step of the integrity check is signature
verification.  The bootloader can have one or more public keys embedded in it
at build time.  During signature verification, the bootloader verifies that an
image was signed with a private key that corresponds to the embedded KEYHASH
TLV.</p>
<p>For information on embedding public keys in the bootloader, as well as
producing signed images, see: <a href="../signed_images/">signed_images</a>.</p>
<p>If you want to enable and use encrypted images, see:
<a href="../encrypted_images/">encrypted_images</a>.</p>
<hr />
<p><strong><em>Note</em></strong></p>
<p><em>Image encryption is not supported when the direct-xip upgrade strategy</em>
<em>is selected.</em></p>
<hr />
<h3 id="using-hardware-keys-for-verification"><a href="#hw-key-support">Using hardware keys for verification</a></h3>
<p>By default, the whole public key is embedded in the bootloader code and its
hash is added to the image manifest as a KEYHASH TLV entry. As an alternative
the bootloader can be made independent of the keys by setting the
<code>MCUBOOT_HW_KEY</code> option. In this case the hash of the public key must be
provisioned to the target device and MCUboot must be able to retrieve the
key-hash from there. For this reason the target must provide a definition
for the <code>boot_retrieve_public_key_hash()</code> function which is declared in
<code>boot/bootutil/include/bootutil/sign_key.h</code>. It is also required to use
the <code>full</code> option for the <code>--public-key-format</code> imgtool argument in order to
add the whole public key (PUBKEY TLV) to the image manifest instead of its
hash (KEYHASH TLV). During boot the public key is validated before using it for
signature verification, MCUboot calculates the hash of the public key from the
TLV area and compares it with the key-hash that was retrieved from the device.
This way MCUboot is independent from the public key(s). The key(s) can be
provisioned any time and by different parties.</p>
<h2 id="protected-tlvs"><a href="#protected-tlvs">Protected TLVs</a></h2>
<p>If the TLV area contains protected TLV entries, by beginning with a <code>struct
image_tlv_info</code> with a magic value of <code>IMAGE_TLV_PROT_INFO_MAGIC</code> then the
data of those TLVs must also be integrity and authenticity protected. Beyond
the full size of the protected TLVs being stored in the <code>image_tlv_info</code>,
the size of the protected TLVs together with the size of the <code>image_tlv_info</code>
struct itself are also saved in the <code>ih_protected_size</code> field inside the
header.</p>
<p>Whenever an image has protected TLVs the SHA256 has to be calculated over
not just the image header and the image but also the TLV info header and the
protected TLVs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>A +---------------------+
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>  | Header              | &lt;- struct image_header
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>  +---------------------+
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>  | Payload             |
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>  +---------------------+
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>  | TLV area            |
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>  | +-----------------+ |    struct image_tlv_info with
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>  | | TLV area header | | &lt;- IMAGE_TLV_PROT_INFO_MAGIC (optional)
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>  | +-----------------+ |
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>  | | Protected TLVs  | | &lt;- Protected TLVs (struct image_tlv)
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>B | +-----------------+ |
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>  | | TLV area header | | &lt;- struct image_tlv_info with IMAGE_TLV_INFO_MAGIC
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>C | +-----------------+ |
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>  | | SHA256 hash     | | &lt;- hash from A - B (struct image_tlv)
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>D | +-----------------+ |
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>  | | Keyhash         | | &lt;- indicates which pub. key for sig (struct image_tlv)
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>  | +-----------------+ |
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>  | | Signature       | | &lt;- signature from C - D (struct image_tlv), only hash
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>  | +-----------------+ |
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>  +---------------------+
</code></pre></div>
<h2 id="dependency-check"><a href="#dependency-check">Dependency check</a></h2>
<p>MCUboot can handle multiple firmware images. It is possible to update them
independently but in many cases it can be desired to be able to describe
dependencies between the images (e.g. to ensure API compliance and avoid
interoperability issues).</p>
<p>The dependencies between images can be described with additional TLV entries in
the protected TLV area after the end of an image. There can be more than one
dependency entry, but in practice if the platform only supports two individual
images then there can be maximum one entry which reflects to the other image.</p>
<p>At the phase of dependency check all aborted swaps are finalized if there were
any. During the dependency check the bootloader verifies whether the image
dependencies are all satisfied. If at least one of the dependencies of an image
is not fulfilled then the swap type of that image has to be modified
accordingly and the dependency check needs to be restarted. This way the number
of unsatisfied dependencies will decrease or remain the same. There is always at
least 1 valid configuration. In worst case, the system returns to the initial
state after dependency check.</p>
<p>For more information on adding dependency entries to an image,
see: <a href="../imgtool/">imgtool</a>.</p>
<h2 id="downgrade-prevention"><a href="#downgrade-prevention">Downgrade prevention</a></h2>
<p>Downgrade prevention is a feature which enforces that the new image must have a
higher version/security counter number than the image it is replacing, thus
preventing the malicious downgrading of the device to an older and possibly
vulnerable version of its firmware.</p>
<h3 id="software-based-downgrade-prevention"><a href="#sw-downgrade-prevention">Software-based downgrade prevention</a></h3>
<p>During the software based downgrade prevention the image version numbers are
compared. This feature is enabled with the <code>MCUBOOT_DOWNGRADE_PREVENTION</code>
option. In this case downgrade prevention is only available when the
overwrite-based image update strategy is used (i.e. <code>MCUBOOT_OVERWRITE_ONLY</code>
is set).</p>
<h3 id="hardware-based-downgrade-prevention"><a href="#hw-downgrade-prevention">Hardware-based downgrade prevention</a></h3>
<p>Each signed image can contain a security counter in its protected TLV area, which
can be added to the image using the <code>-s</code> option of the <a href="../imgtool/">imgtool</a> script.
During the hardware based downgrade prevention (alias rollback protection) the
new image's security counter will be compared with the currently active security
counter value which must be stored in a non-volatile and trusted component of
the device. It is beneficial to handle this counter independently from image
version number:</p>
<ul>
<li>It does not need to increase with each software release,</li>
<li>It makes it possible to do software downgrade to some extent: if the
    security counter has the same value in the older image then it is accepted.</li>
</ul>
<p>It is an optional step of the image validation process and can be enabled with
the <code>MCUBOOT_HW_ROLLBACK_PROT</code> config option. When enabled, the target must
provide an implementation of the security counter interface defined in
<code>boot/bootutil/include/security_cnt.h</code>.</p>
<h2 id="measured-boot-and-data-sharing"><a href="#boot-data-sharing">Measured boot and data sharing</a></h2>
<p>MCUboot defines a mechanism for sharing boot status information (also known as
measured boot) and an interface for sharing application specific information
with the runtime software. If any of these are enabled the target must provide
a shared data area between the bootloader and runtime firmware and define the
following parameters:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="cp">#define MCUBOOT_SHARED_DATA_BASE    &lt;area_base_addr&gt;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="cp">#define MCUBOOT_SHARED_DATA_SIZE    &lt;area_size_in_bytes&gt;</span>
</code></pre></div>
<p>In the shared memory area all data entries are stored in a type-length-value
(TLV) format. Before adding the first data entry, the whole area is overwritten
with zeros and a TLV header is added at the beginning of the area during an
initialization phase. This TLV header contains a <code>tlv_magic</code> field with a value
of <code>SHARED_DATA_TLV_INFO_MAGIC</code> and a <code>tlv_tot_len</code> field which is indicating
the total length of shared TLV area including this header. The header is
followed by the the data TLV entries which are composed from a
<code>shared_data_tlv_entry</code> header and the data itself. In the data header there is
a <code>tlv_type</code> field which identifies the consumer of the entry (in the runtime
software) and specifies the subtype of that data item. More information about
the <code>tlv_type</code> field and data types can be found in the
<code>boot/bootutil/include/bootutil/boot_status.h</code> file. The type is followed by a
<code>tlv_len</code> field which indicates the size of the data entry in bytes, not
including the entry header. After this header structure comes the actual data.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="cm">/** Shared data TLV header.  All fields in little endian. */</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">shared_data_tlv_header</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">tlv_magic</span><span class="p">;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">tlv_tot_len</span><span class="p">;</span><span class="w"> </span><span class="cm">/* size of whole TLV area (including this header) */</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="p">};</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="cm">/** Shared data TLV entry header format. All fields in little endian. */</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">shared_data_tlv_entry</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">tlv_type</span><span class="p">;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">tlv_len</span><span class="p">;</span><span class="w"> </span><span class="cm">/* TLV data length (not including this header). */</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="p">};</span>
</code></pre></div>
<p>The measured boot can be enabled with the <code>MCUBOOT_MEASURED_BOOT</code> config option.
When enabled, the <code>--boot_record</code> argument of the imgtool script must also be
used during the image signing process to add a BOOT_RECORD TLV to the image
manifest. This TLV contains the following attributes/measurements of the
image in CBOR encoded format:</p>
<ul>
<li>Software type (role of the software component)</li>
<li>Software version</li>
<li>Signer ID (identifies the signing authority)</li>
<li>Measurement value (hash of the image)</li>
<li>Measurement type (algorithm used to calculate the measurement value)</li>
</ul>
<p>The <code>sw_type</code> string that is passed as the <code>--boot_record</code> option's parameter
will be the value of the "Software type" attribute in the generated BOOT_RECORD
TLV. The target must also define the <code>MAX_BOOT_RECORD_SZ</code> macro which indicates
the maximum size of the CBOR encoded boot record in bytes.
During boot, MCUboot will look for these TLVs (in case of multiple images) in
the manifests of the active images (the latest and validated) and copy the CBOR
encoded binary data to the shared data area. Preserving all these image
attributes from the boot stage for use by later runtime services (such as an
attestation service) is known as a measured boot.</p>
<p>Setting the <code>MCUBOOT_DATA_SHARING</code> option enables the sharing of application
specific data using the same shared data area as for the measured boot. For
this, the target must provide a definition for the <code>boot_save_shared_data()</code>
function which is declared in <code>boot/bootutil/include/bootutil/boot_record.h</code>.
The <code>boot_add_data_to_shared_area()</code> function can be used for adding new TLV
entries to the shared data area. Alternatively, setting the
<code>MCUBOOT_DATA_SHARING_BOOTINFO</code> option will provide a default function for
this which saves information such as the maximum application size, bootloader
version (if available), running slot number, if recovery is part of MCUboot
and the signature type. Details of the TLVs for this information can be found
in <code>boot/bootutil/include/bootutil/boot_status.h</code> with <code>BLINFO_</code> prefixes.</p>
<h2 id="testing-in-ci"><a href="#testing-in-ci">Testing in CI</a></h2>
<h3 id="testing-fault-injection-hardening-fih"><a href="#testing-fih">Testing Fault Injection Hardening (FIH)</a></h3>
<p>The CI currently tests the Fault Injection Hardening feature of MCUboot by
executing instruction skip during execution, and looking at whether a corrupted
image was booted by the bootloader or not.</p>
<p>The main idea is that instruction skipping can be automated by scripting a
debugger to automatically execute the following steps:</p>
<ul>
<li>Set breakpoint at specified address.</li>
<li>Continue execution.</li>
<li>On breakpoint hit increase the Program Counter.</li>
<li>Continue execution.</li>
<li>Detach from target after a timeout reached.</li>
</ul>
<p>Whether or not the corrupted image was booted or not can be decided by looking
for certain entries in the log.</p>
<p>As MCUboot is deployed on a microcontroller, testing FI would not make much
sense in the simulator environment running on a host machine with different
architecture than the MCU's, as the degree of hardening depends on compiler
behavior. For example, (a bit counterintuitively) the code produced by gcc
with <code>-O0</code> optimisation is more resilient against FI attacks than the code
generated with <code>-O3</code> or <code>-Os</code> optimizations.</p>
<p>To run on a desired architecture in the CI, the tests need to be executed on an
emulator (as real devices are not available in the CI environment). For this
implementation QEMU is selected.</p>
<p>For the tests MCUboot needs a set of drivers and an implementation of a main
function. For the purpose of this test Trusted-Firmware-M has been selected as
it supports Armv8-M platforms that are also emulated by QEMU.</p>
<p>The tests run in a docker container inside the CI VMs, to make it more easy to
deploy build and test environment (QEMU, compilers, interpreters). The CI VMs
seems to be using quite old Ubuntu (16.04).</p>
<p>The sequence of the testing is the following (pseudo code):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>fn<span class="w"> </span>main<span class="o">()</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="c1"># Implemented in ci/fih-tests_install.sh</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">  </span>generate_docker_image<span class="o">(</span>Dockerfile<span class="o">)</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="c1"># See details below. Implemented in ci/fih-tests_run.sh.</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span><span class="c1"># Calling the function with different parameters is done by Travis CI based on</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">  </span><span class="c1"># the values provided in the .travis.yaml</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">  </span>start_docker_image<span class="o">(</span>skip_sizes,<span class="w"> </span>build_type,<span class="w"> </span>damage_type,<span class="w"> </span>fih_level<span class="o">)</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>fn<span class="w"> </span>start_docker_image<span class="o">(</span>skip_sizes,<span class="w"> </span>build_type,<span class="w"> </span>damage_type,<span class="w"> </span>fih_level<span class="o">)</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">  </span><span class="c1"># implemented in ci/fih_test_docker/execute_test.sh</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">  </span>compile_mcuboot<span class="o">(</span>build_type<span class="o">)</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">  </span><span class="c1"># implemented in ci/fih_test_docker/damage_image.py</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">  </span>damage_image<span class="o">(</span>damage_type<span class="o">)</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">  </span><span class="c1"># implemented in ci/fih_test_docker/run_fi_test.sh</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">  </span><span class="nv">ranges</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>generate_address_ranges<span class="o">()</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span>s<span class="w"> </span><span class="k">in</span><span class="w"> </span>skip_sizes
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>r<span class="w"> </span><span class="k">in</span><span class="w"> </span>ranges
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">      </span>do_skip_in_qemu<span class="o">(</span>s,<span class="w"> </span>r<span class="o">)</span><span class="w"> </span><span class="c1"># See details below</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">  </span>evaluate_logs<span class="o">()</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>fn<span class="w"> </span>do_skip_in_qemu<span class="o">(</span>size,<span class="w"> </span>range<span class="o">)</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span><span class="k">in</span><span class="w"> </span>r
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">    </span>run_qemu<span class="o">(</span>a,<span class="w"> </span>size<span class="o">)</span><span class="w">  </span><span class="c1"># See details below</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="c1"># this part is implemented in ci/fih_test_docker/fi_tester_gdb.sh</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>fn<span class="w"> </span>run_qemu<span class="o">(</span>a,<span class="w"> </span>size<span class="o">)</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">  </span><span class="nv">script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>create_debugger_script<span class="o">(</span>a,<span class="w"> </span>size<span class="o">)</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">  </span>start_qemu_in_bacground<span class="o">()</span><span class="w"> </span><span class="c1"># logs serial out to a file</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">  </span>gdb_attach_to_qemu<span class="o">(</span>script<span class="o">)</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="w">  </span>kill_qemu<span class="o">()</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="w">  </span><span class="c1"># This checks the debugger and the quemu logs, and decides whether the tets</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="w">  </span><span class="c1"># was executed successfully, and whether the image is booted or not. Then</span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="w">  </span><span class="c1"># emits a yaml fragment on the standard out to be processed by the caller</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="w">  </span><span class="c1"># script</span>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="w">  </span>evaluate_run<span class="o">(</span>qemu_log_file<span class="o">)</span>
</code></pre></div>
<p>Further notes:</p>
<ul>
<li>The image is corrupted by changing its signature.</li>
<li>MCUBOOT_FIH_PROFILE_MAX is not tested as it requires TRNG, and the AN521
platform has no support for it. However this profile adds the random
execution delay to the code, so should not affect the instruction skip results
too much, because break point is placed at exact address. But in practice this
makes harder the accurate timing of the attack.</li>
<li>The test cases defined in .travis.yml always return <code>passed</code>, if they were
executed successfully. A yaml file is created during test execution with the
details of the test execution results. A summary of the collected results is
printed in the log at the end of the test.</li>
</ul>
<p>An advantage of having the tests running in a docker image is that it is
possible to run the tests on a local machine that has git and docker, without
installing any additional software.</p>
<p>So, running the test on the host looks like the following (The commands below
are issued from the MCUboot source directory):</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>$<span class="w"> </span>mkdir<span class="w"> </span>docker
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>$<span class="w"> </span>./ci/fih-tests_install.sh
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>$<span class="w"> </span><span class="nv">FIH_LEVEL</span><span class="o">=</span>MEDIUM<span class="w"> </span><span class="nv">BUILD_TYPE</span><span class="o">=</span>RELEASE<span class="w"> </span><span class="nv">SKIP_SIZE</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">DAMAGE_TYPE</span><span class="o">=</span>SIGNATURE<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">     </span>./ci/fih-tests_run.sh
</code></pre></div>
On the travis CI the environment variables in the last command are set based on
the configs provided in the <code>.travis.yaml</code></p>
<p>This starts the tests, however the shell that it is running in is not
interactive, it is not possible to examine the results of the test run. To have
an interactive shell where the results can be examined, the following can be
done:</p>
<ul>
<li>The docker image needs to be built with <code>ci/fih-tests_install.sh</code> as described
  above.</li>
<li>Start the docker image with the following command:
  <code>docker run -i -t mcuboot/fih-test</code>.</li>
<li>Execute the test with a command similar to the following:
  <code>/root/execute_test.sh 8 RELEASE SIGNATURE MEDIUM</code>. After the test finishes,
  the shell returns, and it is possible to investigate the results. It is also
  possible to stop the test with <em>Ctrl+c</em>. The parameters to the
  <code>execute_test.sh</code> are <code>SKIP_SIZE</code>, <code>BUILD_TYPE</code>, <code>DAMAGE_TYPE</code>, <code>FIH_LEVEL</code> in
  order.</li>
</ul>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">&copy <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://www.owntech.org">OwnTech Foundation</a> under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></p> <a href="#__consent">Change cookie settings</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/owntech-foundation" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discord.com/invite/KAM8ukUYF5" target="_blank" rel="noopener" title="discord.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:contact@owntech.org" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  





<h4>Cookie Consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "navigation.footer", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>